<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' https://pagead2.googlesyndication.com;">
    <title>Image Compressor - Colorful UI</title>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- AdSense Script -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9239182778221521" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #ff6b6b, #4ecdc4);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #333;
        }
        .container {
            max-width: 800px;
            width: 90%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            padding: 40px;
            margin: 30px 0;
        }
        h1 {
            text-align: center;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        .section {
            margin-bottom: 40px;
        }
        .section h2 {
            background: linear-gradient(45deg, #2c3e50, #6e8efb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 600;
            font-size: 1.8em;
            margin-bottom: 15px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        input[type="file"], input[type="number"], select {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 1.1em;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input[type="file"]:focus, input[type="number"]:focus, select:focus {
            border-color: #ff6b6b;
            box-shadow: 0 0 8px rgba(255, 107, 107, 0.3);
            outline: none;
        }
        button {
            padding: 15px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
        }
        #compressBtn {
            background: linear-gradient(45deg, #28a745, #34c759);
            color: white;
        }
        #downloadBtn {
            background: linear-gradient(45deg, #007bff, #00d4ff);
            color: white;
            display: none;
        }
        #preview, #compressedImage {
            max-width: 100%;
            margin-top: 15px;
            border-radius: 10px;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        .how-it-works {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
        }
        .how-it-works ul {
            list-style: none;
            padding: 0;
        }
        .how-it-works li {
            margin-bottom: 20px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 12px;
            color: #2c3e50;
        }
        .how-it-works li::before {
            content: "âœ”";
            color: #ff6b6b;
            font-size: 1.5em;
        }
        .how-it-works li strong {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .ad-container {
            text-align: center;
            margin: 30px 0;
        }
        footer {
            text-align: center;
            margin: 30px 0;
            color: white;
            font-size: 1.1em;
        }
        footer a {
            color: #ffeb3b;
            text-decoration: none;
            margin: 0 15px;
            transition: color 0.3s;
        }
        footer a:hover {
            color: #fff;
            text-decoration: underline;
        }
        @media (max-width: 600px) {
            .container {
                padding: 25px;
            }
            h1 {
                font-size: 2em;
            }
            .section h2 {
                font-size: 1.5em;
            }
            button {
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Image Compressor Tool</h1>

        <!-- AdSense Ad Unit -->
        <div class="ad-container">
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-9239182778221521"
                 data-ad-slot="YOUR_AD_SLOT_ID"
                 data-ad-format="auto"
                 data-full-width-responsive="true"></ins>
            <script>
                (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <!-- Input Section -->
        <div class="section">
            <h2>Upload Image</h2>
            <div class="input-group">
                <input type="file" id="imageInput" accept="image/*" required>
                <img id="preview" alt="Image Preview" style="display: none;">
            </div>
        </div>

        <!-- Settings Section -->
        <div class="section">
            <h2>Compression Settings</h2>
            <div class="input-group">
                <input type="number" id="targetSize" placeholder="Target Size (KB)" min="1" required>
                <select id="sizeUnit">
                    <option value="KB">KB</option>
                    <option value="MB">MB</option>
                </select>
                <button id="compressBtn">Compress Image</button>
            </div>
        </div>

        <!-- Output Section -->
        <div class="section">
            <h2>Compressed Image</h2>
            <img id="compressedImage" alt="Compressed Image" style="display: none;">
            <button id="downloadBtn">Download Compressed Image</button>
        </div>

        <!-- How It Works Section -->
        <div class="section how-it-works">
            <h2>Kaise Kaam Karta Hai?</h2>
            <ul>
                <li><strong>Step 1: Photo Upload</strong> - Apni image select karen ya drag-and-drop karen.</li>
                <li><strong>Step 2: Size Set Karen</strong> - Desired output size (KB ya MB mein) enter karen.</li>
                <li><strong>Step 3: Compress Karen</strong> - "Compress Image" button par click karen.</li>
                <li><strong>Step 4: Download Karen</strong> - Compressed image ko download karen.</li>
            </ul>
        </div>
    </div>

    <!-- Footer with Links -->
    <footer>
        <a href="about.html">About</a> | <a href="contact.html">Contact</a> | <a href="privacy.html">Privacy Policy</a>
    </footer>

    <script>
        const imageInput = document.getElementById('imageInput');
        const preview = document.getElementById('preview');
        const targetSizeInput = document.getElementById('targetSize');
        const sizeUnit = document.getElementById('sizeUnit');
        const compressBtn = document.getElementById('compressBtn');
        const compressedImage = document.getElementById('compressedImage');
        const downloadBtn = document.getElementById('downloadBtn');

        imageInput.addEventListener('change', () => {
            const file = imageInput.files[0];
            if (file) {
                preview.src = URL.createObjectURL(file);
                preview.style.display = 'block';
            }
        });

        compressBtn.addEventListener('click', async () => {
            const file = imageInput.files[0];
            if (!file || !targetSizeInput.value) {
                alert('Please select an image and enter a target size.');
                return;
            }

            const targetSizeKB = sizeUnit.value === 'MB' ? parseFloat(targetSizeInput.value) * 1024 : parseFloat(targetSizeInput.value);
            const compressedDataUrl = await compressImage(file, targetSizeKB);

            if (compressedDataUrl) {
                compressedImage.src = compressedDataUrl;
                compressedImage.style.display = 'block';
                downloadBtn.style.display = 'block';
                downloadBtn.onclick = () => {
                    const link = document.createElement('a');
                    link.href = compressedDataUrl;
                    link.download = 'compressed_image.jpg';
                    link.click();
                };
            } else {
                alert('Could not compress to desired size without significant quality loss.');
            }
        });

        async function compressImage(file, targetSizeKB) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            img.src = URL.createObjectURL(file);

            await new Promise(resolve => img.onload = resolve);

            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);

            let quality = 0.9;
            let low = 0.1;
            let high = 0.9;
            let dataUrl;

            for (let i = 0; i < 10; i++) {
                dataUrl = canvas.toDataURL('image/jpeg', quality);
                const sizeKB = Math.round(((dataUrl.length - 'data:image/jpeg;base64,'.length) * 3 / 4) / 1024);

                if (Math.abs(sizeKB - targetSizeKB) < 10 || low >= high) break;

                if (sizeKB > targetSizeKB) {
                    high = quality;
                    quality = (quality + low) / 2;
                } else {
                    low = quality;
                    quality = (quality + high) / 2;
                }
            }

            const finalSizeKB = Math.round(((dataUrl.length - 'data:image/jpeg;base64,'.length) * 3 / 4) / 1024);
            if (finalSizeKB > targetSizeKB * 1.1 || finalSizeKB < targetSizeKB * 0.9) {
                return null;
            }

            return dataUrl;
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Passport Photo Maker (n-dizi.in)</title>

<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/body-pix"></script>

<style>
/* ‡§Ü‡§™‡§ï‡§æ ‡§Æ‡•å‡§ú‡•Ç‡§¶‡§æ CSS ‡§Ø‡§π‡§æ‡§Å ‡§∞‡§π‡•á‡§ó‡§æ */
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:linear-gradient(135deg,#667eea,#764ba2);
  min-height:100vh;
  padding:10px;
}
.container{
  max-width:900px;
  margin:auto;
  background:#fff;
  border-radius:16px;
  box-shadow:0 20px 60px rgba(0,0,0,.35);
  overflow:hidden;
}
.header{
  background:linear-gradient(135deg,#1e3c72,#2a5298);
  color:#fff;
  padding:20px;
  text-align:center;
}
.header h1{font-size:22px}
.header p{font-size:13px;opacity:.9}
.content{padding:20px}
.upload-section{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:15px}
.upload-btn,.camera-btn{border:2px dashed #667eea;border-radius:12px;padding:28px 15px;text-align:center;cursor:pointer;background:#f6f7ff;transition:.25s}
.upload-btn:hover,.camera-btn:hover{background:#eef0ff;transform:scale(1.02)}
.upload-btn .icon,.camera-btn .icon{font-size:38px}
.upload-btn h3,.camera-btn h3{font-size:15px;margin:6px 0}
input[type=file]{display:none}
.settings{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:15px}
.setting{background:#f8f9fa;border:2px solid #e5e7eb;border-radius:10px;padding:10px}
.setting label{display:block;font-weight:600;font-size:12px;margin-bottom:5px}
.setting select,.setting input[type=color],.setting input[type=range]{width:100%}
.btn{width:100%;padding:14px;border:none;border-radius:25px;font-weight:700;font-size:15px;cursor:pointer;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;box-shadow:0 8px 25px rgba(102,126,234,.45)}
.btn:disabled{opacity:.5;cursor:not-allowed}
#loadingStatus{display:none;color:#764ba2;font-weight:bold;margin-top:10px;text-align:center}
.result{display:none;text-align:center;margin-top:20px}
.result canvas{max-width:100%;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.2)}
.camera-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:999}
.camera-box{background:#fff;max-width:420px;margin:40px auto;padding:15px;border-radius:12px;text-align:center}
.camera-box video{width:100%;border-radius:10px}
.capture{background:#16a085;color:#fff;padding:10px 18px;border-radius:20px;border:none;cursor:pointer}
.close{background:#e74c3c;color:#fff;padding:10px 18px;border-radius:20px;border:none;cursor:pointer}
@media(max-width:600px){.upload-section,.settings{grid-template-columns:1fr}}
</style>
</head>

<body>
<div class="container">
  <div class="header">
    <h1>üéØ AI Passport Photo Maker</h1>
    <p>Auto Background Removal ‚Ä¢ Print Ready Sheet</p>
  </div>

  <div class="content">
    <div class="upload-section">
      <div class="upload-btn" id="uploadBtn">
        <div class="icon">üìÅ</div>
        <h3>Upload Photo</h3>
      </div>
      <div class="camera-btn" id="cameraBtn">
        <div class="icon">üì∏</div>
        <h3>Take Photo</h3>
      </div>
    </div>

    <input type="file" id="fileInput" accept="image/*">

    <div class="settings">
      <div class="setting">
        <label>üìê Size</label>
        <select id="size">
          <option value="300,400">Passport (35√ó45mm)</option>
        </select>
      </div>
      <div class="setting">
        <label>üé® BG Color</label>
        <input type="color" id="bg" value="#3b92d1">
      </div>
      <div class="setting">
        <label>üìã Copies</label>
        <select id="copies">
          <option>4</option>
          <option selected>8</option>
        </select>
      </div>
      <div class="setting">
        <label>üñº Border</label>
        <input type="range" id="border" min="0" max="8" value="2">
      </div>
    </div>

    <div id="loadingStatus">‚è≥ Removing Background... Please wait</div>
    <button class="btn" id="generate" disabled>üöÄ Generate Print Sheet</button>

    <div class="result" id="result">
      <canvas id="canvas"></canvas>
      <p style="margin-top:10px; font-size:12px;">Right click to Save / Long press to Download</p>
    </div>
  </div>
</div>

<div class="camera-modal" id="cameraModal">
  <div class="camera-box">
    <video id="video" autoplay playsinline></video>
    <div><button class="capture" id="capture">Capture</button><button class="close" id="closeCam">Close</button></div>
  </div>
</div>

<script>
const fileInput=document.getElementById("fileInput");
const generate=document.getElementById("generate");
const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const loadingStatus=document.getElementById("loadingStatus");

let img=new Image(), net;

// Load AI Model on Start
async function loadModel() {
    net = await bodyPix.load();
    console.log("Model Loaded");
}
loadModel();

document.getElementById("uploadBtn").onclick=()=>fileInput.click();
fileInput.onchange=e=>{
    const r=new FileReader();
    r.onload=()=>{img.src=r.result; generate.disabled=false;}
    r.readAsDataURL(e.target.files[0]);
};

// ‡§ï‡•à‡§Æ‡§∞‡§æ ‡§≤‡•â‡§ú‡§ø‡§ï (Same as before)
// ... (capture code remains same)

generate.onclick = async () => {
    generate.disabled = true;
    loadingStatus.style.display = "block";

    // 1. AI Background Removal (BodyPix)
    const segmentation = await net.segmentPerson(img);
    
    // Create an offscreen canvas for the single cut-out photo
    const [pw, ph] = document.getElementById("size").value.split(",").map(Number);
    const tempCanvas = document.createElement("canvas");
    const tCtx = tempCanvas.getContext("2d");
    tempCanvas.width = pw;
    tempCanvas.height = ph;

    // Background color
    tCtx.fillStyle = document.getElementById("bg").value;
    tCtx.fillRect(0, 0, pw, ph);

    // Draw Person Only
    const tempImgCanvas = document.createElement("canvas");
    tempImgCanvas.width = img.width;
    tempImgCanvas.height = img.height;
    const tempImgCtx = tempImgCanvas.getContext("2d");
    tempImgCtx.drawImage(img, 0, 0);
    
    const imgData = tempImgCtx.getImageData(0, 0, img.width, img.height);
    for (let i = 0; i < imgData.data.length; i += 4) {
        if (!segmentation.data[i / 4]) {
            imgData.data[i + 3] = 0; // Make background transparent
        }
    }
    tempImgCtx.putImageData(imgData, 0, 0);

    // Auto Center Crop & Draw
    const ar = img.width / img.height;
    let sx = 0, sy = 0, sw = img.width, sh = img.height;
    if (ar > pw / ph) { sw = img.height * (pw / ph); sx = (img.width - sw) / 2; }
    else { sh = img.width * (ph / pw); sy = (img.height - sh) / 2; }
    
    tCtx.drawImage(tempImgCanvas, sx, sy, sw, sh, 0, 0, pw, ph);

    // 2. Create Sheet with Multiple Copies
    const copies = parseInt(document.getElementById("copies").value);
    const border = parseInt(document.getElementById("border").value);
    const gap = 20;
    const cols = Math.ceil(Math.sqrt(copies));
    const rows = Math.ceil(copies / cols);

    canvas.width = cols * (pw + 2 * border) + (cols + 1) * gap;
    canvas.height = rows * (ph + 2 * border) + (rows + 1) * gap;

    ctx.fillStyle = "#fff"; // Paper background
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    for (let i = 0; i < copies; i++) {
        const r = Math.floor(i / cols);
        const c = i % cols;
        const x = gap + c * (pw + 2 * border + gap);
        const y = gap + r * (ph + 2 * border + gap);

        // Draw Border
        ctx.fillStyle = "#000";
        ctx.fillRect(x, y, pw + 2 * border, ph + 2 * border);
        
        // Draw the processed photo
        ctx.drawImage(tempCanvas, x + border, y + border);
    }

    loadingStatus.style.display = "none";
    document.getElementById("result").style.display = "block";
    generate.disabled = false;
};
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Passport Size Photo Maker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 2rem;
    }
    #preview {
      margin: 1rem auto;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: center;
    }
    canvas {
      border: 1px solid #ccc;
    }
    label, input, select, button {
      margin: 5px;
    }
  </style>
</head>
<body>
  <h2>Passport Size Photo Maker</h2>

  <input type="file" id="fileInput" accept="image/*"><br>

  <label>Background Color:</label>
  <input type="color" id="bgColor" value="#ffffff"><br>

  <label>Photo Size:</label>
  <select id="photoSize">
    <option value="35x45">35x45 mm</option>
    <option value="2x2">2x2 inch</option>
  </select><br>

  <label>Number of Copies:</label>
  <input type="number" id="numCopies" value="4" min="1" max="30"><br>

  <label>Black & White:</label>
  <input type="checkbox" id="bwMode"><br>

  <button onclick="generate()">Generate Photo Sheet</button>

  <div id="preview"></div>

  <script>
    function mmToPx(mm, dpi = 300) {
      return Math.round((mm / 25.4) * dpi);
    }

    function inchToPx(inch, dpi = 300) {
      return Math.round(inch * dpi);
    }

    function generate() {
      const fileInput = document.getElementById("fileInput");
      const bgColor = document.getElementById("bgColor").value;
      const photoSize = document.getElementById("photoSize").value;
      const numCopies = parseInt(document.getElementById("numCopies").value);
      const bwMode = document.getElementById("bwMode").checked;
      const preview = document.getElementById("preview");
      preview.innerHTML = "";

      if (!fileInput.files[0]) {
        alert("Please select an image.");
        return;
      }

      const reader = new FileReader();
      reader.onload = function (e) {
        const img = new Image();
        img.onload = function () {
          let width, height;
          if (photoSize === "35x45") {
            width = mmToPx(35);
            height = mmToPx(45);
          } else if (photoSize === "2x2") {
            width = inchToPx(2);
            height = inchToPx(2);
          }

          const gap = 20;
          const columns = Math.ceil(Math.sqrt(numCopies));
          const rows = Math.ceil(numCopies / columns);

          const canvas = document.createElement("canvas");
          canvas.width = columns * (width + gap) - gap;
          canvas.height = rows * (height + gap) - gap;
          const ctx = canvas.getContext("2d");
          ctx.fillStyle = bgColor;
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          for (let i = 0; i < numCopies; i++) {
            const x = (i % columns) * (width + gap);
            const y = Math.floor(i / columns) * (height + gap);

            const tempCanvas = document.createElement("canvas");
            tempCanvas.width = width;
            tempCanvas.height = height;
            const tempCtx = tempCanvas.getContext("2d");

            tempCtx.drawImage(img, 0, 0, width, height);

            if (bwMode) {
              const imageData = tempCtx.getImageData(0, 0, width, height);
              const data = imageData.data;
              for (let j = 0; j < data.length; j += 4) {
                const avg = (data[j] + data[j + 1] + data[j + 2]) / 3;
                data[j] = data[j + 1] = data[j + 2] = avg;
              }
              tempCtx.putImageData(imageData, 0, 0);
            }

            ctx.drawImage(tempCanvas, x, y);
          }

          preview.appendChild(canvas);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(fileInput.files[0]);
    }
  </script>
</body>
</html>

:center}
  .header h1{font-size:22px; margin-bottom:5px}
  
  .instructions{background:#fff9db; padding:12px; margin:15px; border-radius:8px; border-left:5px solid #fcc419; font-size:13px; color:#856404}

  .content{padding:20px}
  .upload-section{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px}
  .box-btn{border:2px dashed #667eea; border-radius:12px; padding:25px; text-align:center; cursor:pointer; background:#f6f7ff; transition:0.3s}
  .box-btn:hover{background:#eef0ff; transform:translateY(-2px)}
  input[type=file]{display:none}

  .settings{display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:12px; margin-bottom:20px}
  .setting-item{background:#f8f9fa:center}
  .header h1{font-size:22px; margin-bottom:5px}
  
  .instructions{background:#fff9db; padding:12px; margin:15px; border-radius:8px; border-left:5px solid #fcc419; font-size:13px; color:#856404}

  .content{padding:20px}
  .upload-section{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px}
  .box-btn{border:2px dashed #667eea; border-radius:12px; padding:25px; text-align:center; cursor:pointer; background:#f6f7ff; transition:0.3s}
  .box-btn:hover{background:#eef0ff; transform:translateY(-2px)}
  input[type=file]{display:none}

  .settings{display:grid; grid-template-columns:repeat(auto-fit, minmax(140px, 1fr)); gap:12px; margin-bottom:20px}
  .setting-item{background:#f8f9fa; padding:10px; border-radius:10px; border:1px solid #e5e7eb}
  .setting-item label{display:block; font-size:11px; font-weight:bold; margin-bottom:5px; color:#444}
  .setting-item select, .setting-item input{width:100%; padding:8px; border-radius:6px; border:1px solid #ccc}

  .main-btn{width:100%; padding:15px; border:none; border-radius:30px; font-weight:bold; font-size:16px; cursor:pointer; background:linear-gradient(135deg,#667eea,#764ba2); color:#fff; box-shadow:0 8px 20px rgba(102,126,234,0.4)}
  .main-btn:disabled{opacity:0.6; cursor:not-allowed}

  #loadingStatus{display:none; text-align:center; margin:15px 0; color:#764ba2; font-weight:bold}

  .result-area{display:none; text-align:center; margin-top:25px; padding-top:20px; border-top:2px solid #eee}
  canvas{max-width:100%; border-radius:8px; margin-bottom:15px; box-shadow:0 10px 30px rgba(0,0,0,0.1)}
  
  .action-btns{display:flex; gap:10px; justify-content:center}
  .download-btn{background:#27ae60; color:#fff; padding:12px 20px; border-radius:25px; text-decoration:none; font-weight:bold}
  .print-btn{background:#2980b9; color:#fff; padding:12px 20px; border-radius:25px; border:none; font-weight:bold; cursor:pointer}

  /* Camera Modal */
  .modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:1000; align-items:center; justify-content:center}
  .modal-content{background:#fff; padding:20px; border-radius:15px; width:90%; max-width:400px; text-align:center}
  video{width:100%; border-radius:10px; background:#000; transform:scaleX(-1)}
  .cam-btns{margin-top:15px; display:flex; gap:10px; justify-content:center}

  @media(max-width:500px){ .upload-section{grid-template-columns:1fr} }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üéØ AI Passport Photo Maker</h1>
    <p>Auto Background Removal ‚Ä¢ No Data Save ‚Ä¢ 100% Private</p>
  </div>

  <div class="instructions">
    <b>üí° Instructions:</b>
    1. Upload a clear photo. 2. AI will automatically <b>Zoom & Remove Background</b>. 3. Download or Print your sheet.
  </div>

  <div class="content">
    <div class="upload-section">
      <div class="box-btn" onclick="document.getElementById('fileInput').click()">üìÅ Upload Photo</div>
      <div class="box-btn" id="startCam">üì∏ Take Photo</div>
    </div>
    <input type="file" id="fileInput" accept="image/*">

    <div class="settings">
      <div class="setting-item">
        <label>Size</label>
        <select id="size">
          <option value="350,450">Passport (3.5x4.5 cm)</option>
          <option value="413,531">Visa (2x2 inch)</option>
          <option value="236,354">Stamp Size</option>
        </select>
      </div>
      <div class="setting-item">
        <label>BG Color</label>
        <input type="color" id="bgColor" value="#3b92d1">
      </div>
      <div class="setting-item">
        <label>Copies</label>
        <select id="copies">
          <option value="4">4 Photos</option>
          <option value="8" selected>8 Photos</option>
          <option value="12">12 Photos</option>
        </select>
      </div>
      <div class="setting-item">
        <label>Border</label>
        <input type="range" id="border" min="0" max="8" value="2">
      </div>
    </div>

    <div id="loadingStatus">‚è≥ AI is Fixing Edges & Removing Background...</div>
    <button class="main-btn" id="generate" disabled>üöÄ Generate Print Sheet</button>

    <div class="result-area" id="resultArea">
      <canvas id="outputCanvas"></canvas>
      <div class="action-btns">
        <a href="#" class="download-btn" id="downloadLink">üì• Download JPG</a>
        <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Now</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="camModal">
  <div class="modal-content">
    <video id="video" autoplay playsinline></video>
    <div class="cam-btns">
      <button class="download-btn" id="capture">Capture</button>
      <button class="print-btn" style="background:#e74c3c" id="closeCam">Close</button>
    </div>
  </div>
</div>

<script>
  /* JavaScript Section */
  const fileInput = document.getElementById('fileInput');
  const generateBtn = document.getElementById('generate');
  const canvas = document.getElementById('outputCanvas');
  const ctx = canvas.getContext('2d');
  const loadingStatus = document.getElementById('loadingStatus');
  let userImg = new Image();

  // 1. Setup AI Model
  const selfieSegmentation = new SelfieSegmentation({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`});
  selfieSegmentation.setOptions({ modelSelection: 1 });

  fileInput.onchange = (e) => {
    const reader = new FileReader();
    reader.onload = () => { userImg.src = reader.result; userImg.onload = () => generateBtn.disabled = false; };
    reader.readAsDataURL(e.target.files[0]);
  };

  // 2. Camera Functions
  const video = document.getElementById('video');
  document.getElementById('startCam').onclick = async () => {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({video: true});
      video.srcObject = stream;
      document.getElementById('camModal').style.display = 'flex';
    } catch(e) { alert("Camera not accessible"); }
  };

  document.getElementById('closeCam').onclick = () => {
    if(video.srcObject) video.srcObject.getTracks().forEach(t => t.stop());
    document.getElementById('camModal').style.display = 'none';
  };

  document.getElementById('capture').onclick = () => {
    const c = document.createElement('canvas');
    c.width = video.videoWidth; c.height = video.videoHeight;
    const cx = c.getContext('2d');
    cx.translate(c.width, 0); cx.scale(-1, 1); // Flip mirror
    cx.drawImage(video, 0, 0);
    userImg.src = c.toDataURL('image/png');
    userImg.onload = () => generateBtn.disabled = false;
    document.getElementById('closeCam').click();
  };

  // 3. Smart Background Removal
  async function removeBG(img) {
    return new Promise(res => {
      selfieSegmentation.onResults(results => {
        const c = document.createElement('canvas');
        c.width = img.width; c.height = img.height;
        const cx = c.getContext('2d');
        
        // Draw mask with smoothing
        cx.save();
        cx.filter = "blur(1px)"; // Soften the edges of the cut
        cx.drawImage(results.segmentationMask, 0, 0, c.width, c.height);
        cx.globalCompositeOperation = 'source-in';
        cx.filter = "none";
        cx.drawImage(results.image, 0, 0);
        cx.restore();
        res(c);
      });
      selfieSegmentation.send({image: img});
    });
  }

  // 4. Final Sheet Generation with Smart Zoom
  generateBtn.onclick = async () => {
    generateBtn.disabled = true;
    loadingStatus.style.display = 'block';

    const processedPerson = await removeBG(userImg);
    
    let [pw, ph] = document.getElementById('size').value.split(',').map(Number);
    const bgColor = document.getElementById('bgColor').value;
    const border = parseInt(document.getElementById('border').value);
    const copies = parseInt(document.getElementById('copies').value);

    // Temp Canvas for Single Photo with Zoom
    const singlePhoto = document.createElement('canvas');
    singlePhoto.width = pw;
    singlePhoto.height = ph;
    const sCtx = singlePhoto.getContext('2d');

    // Background Color
    sCtx.fil= 4;
    sCtx.shadowColor = bgColor;
    sCtx.drawImage(processedPerson, sx, sy, sw, sh, 0, 0, pw, ph);

    // Build the Grid Sheet
    const cols = (copies <= 4) ? 2 : 4;
    const rows = Math.ceil(copies / cols);
    const gap = 20;
    canvas.width = cols * (pw + 2*border) + (cols+1)*gap;
    canvas.height = rows * (ph + 2*border) + (rows+1)*gap;

    ctx.fillStyle = "#ffffff"; // Paper Color
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    for(let i=0; i<copies; i++) {
      const c = i % cols;
      const r = Math.floor(i / cols);
      const x = gap + c * (pw + 2*border + gap);
      const y = gap + r * (ph + 2*border + gap);

      // Draw Border
      if(border > 0) {
        ctx.fillStyle = "#000";
        ctx.fillRect(x, y, pw + 2*border, ph + 2*border);
      }
      ctx.drawImage(singlePhoto, x + border, y + border);
    }

    loadingStatus.style.display = 'none';
    document.getElementById('resultArea').style.display = 'block';
    document.getElementById('downloadLink').href = canvas.toDataURL('image/jpeg', 0.9);
    document.getElementById('downloadLink').download = "ai_passport_photos.jpg";
    generateBtn.disabled = false;
  };
</script>
</body>
 </html>
<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro AI Passport Photo Maker - n-dizi.in</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>

<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Segoe UI',Arial,sans-serif; background:#eef2f7; padding:10px}
  .container{max-width:800px; margin:auto; background:#fff; border-radius:20px; box-shadow:0 15px 35px rgba(0,0,0,0.1); overflow:hidden}
  
  .header{background:#1e3c72; color:#fff; padding:20px; text-align:center}
  .instructions{background:#fff3cd; padding:12px; margin:15px; border-radius:8px; border-left:4px solid #ffca28; font-size:13px}

  .content{padding:20px}
  .upload-area{display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:20px}
  .btn-box{border:2px dashed #1e3c72; border-radius:12px; padding:20px; text-align:center; cursor:pointer; background:#f8fbff}
  input[type=file]{display:none}

  .grid-settings{display:grid; grid-template-columns:repeat(auto-fit, minmax(130px, 1fr)); gap:10px; margin-bottom:20px}
  .card{background:#f1f3f6; padding:10px; border-radius:10px}
  .card label{display:block; font-size:11px; font-weight:bold; margin-bottom:5px}
  .card select, .card input{width:100%; padding:6px; border-radius:5px; border:1px solid #ccc}

  .gen-btn{width:100%; padding:15px; border:none; border-radius:30px; font-weight:bold; background:#1e3c72; color:#fff; cursor:pointer; font-size:16px}
  .gen-btn:disabled{background:#ccc}

  #loader{display:none; text-align:center; margin:15px; color:#1e3c72; font-weight:bold}
  .result-box{display:none; text-align:center; margin-top:20px}
  canvas{max-width:100%; border-radius:5px; border:1px solid #ddd}
  
  .footer-btns{margin-top:15px; display:flex; gap:10px; justify-content:center}
  .dl-btn{background:#28a745; color:#fff; padding:12px 20px; border-radius:25px; text-decoration:none; font-weight:bold}
  .pr-btn{background:#007bff; color:#fff; padding:12px 20px; border-radius:25px; border:none; font-weight:bold; cursor:pointer}

  /* Camera Modal */
  .modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:100; align-items:center; justify-content:center}
  .modal-inner{background:#fff; padding:15px; border-radius:15px; width:90%; max-width:400px}
  video{width:100%; border-radius:10px; transform:scaleX(-1)}
</style>
</head>
<body>

<div class="container">
  <div class="header"><h1>üì∏ AI Passport Master</h1></div>
  
  <div class="instructions">
    <b>‡§ú‡§º‡•Ç‡§Æ ‡§ü‡§ø‡§™:</b> ‡§π‡§Æ‡§®‡•á "Edge Shrinking" ‡§§‡§ï‡§®‡•Ä‡§ï ‡§ú‡•ã‡§°‡§º‡•Ä ‡§π‡•à ‡§ú‡•ã ‡§ó‡§∞‡•ç‡§¶‡§® ‡§ï‡•á ‡§™‡§æ‡§∏ ‡§ï‡•á ‡§™‡•Å‡§∞‡§æ‡§®‡•á ‡§®‡§ø‡§∂‡§æ‡§®‡•ã‡§Ç ‡§ï‡•ã ‡§ï‡§æ‡§ü ‡§¶‡•á‡§ó‡•Ä‡•§
  </div>

  <div class="content">
    <div class="upload-area">
      <div class="btn-box" onclick="document.getElementById('fileIn').click()">üì§ Upload</div>
      <div class="btn-box" id="openCam">üì∏ Camera</div>
    </div>
    <input type="file" id="fileIn" accept="image/*">

    <div class="grid-settings">
      <div class="card"><label>Size</label>
        <select id="pSize"><option value="350,450">Passport (3.5x4.5)</option><option value="413,413">Visa (2x2 inch)</option></select>
      </div>
      <div class="card"><label>BG Color</label><input type="color" id="pColor" value="#3b92d1"></div>
      <div class="card"><label>Copies</label><select id="pCopies"><option value="4">4</option><option value="8" selected>8</option></select></div>
      <div class="card"><label>Border</label><input type="range" id="pBorder" min="0" max="6" value="1"></div>
    </div>

    <div id="loader">‚öôÔ∏è Fine-tuning edges...</div>
    <button class="gen-btn" id="go" disabled>Generate Clean Photos</button>

    <div class="result-box" id="res">
      <canvas id="out"></canvas>
      <div class="footer-btns">
        <a href="#" class="dl-btn" id="dl">Download JPG</a>
        <button class="pr-btn" onclick="window.print()">Print</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="m">
  <div class="modal-inner">
    <video id="v" autoplay playsinline></video>
    <div style="margin-top:10px">
      <button class="dl-btn" id="snap">Snap</button>
      <button class="pr-btn" style="background:#dc3545" id="close">Close</button>
    </div>
  </div>
</div>

<script>
const fileIn = document.getElementById('fileIn');
const go = document.getElementById('go');
const canvas = document.getElementById('out');
const ctx = canvas.getContext('2d');
const loader = document.getElementById('loader');
let mainImg = new Image();

const ai = new SelfieSegmentation({locateFile: (f) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${f}`});
ai.setOptions({ modelSelection: 1 });

fileIn.onchange = (e) => {
  const r = new FileReader();
  r.onload = () => { mainImg.src = r.result; mainImg.onload = () => go.disabled = false; };
  r.readAsDataURL(e.target.files[0]);
};

// Camera
const v = document.getElementById('v');
document.getElementById('openCam').onclick = async () => {
  v.srcObject = await navigator.mediaDevices.getUserMedia({video: true});
  document.getElementById('m').style.display = 'flex';
};
document.getElementById('close').onclick = () => {
  v.srcObject.getTracks().forEach(t => t.stop());
  document.getElementById('m').style.display = 'none';
};
document.getElementById('snap').onclick = () => {
  const c = document.createElement('canvas');
  c.width = v.videoWidth; c.height = v.videoHeight;
  const x = c.getContext('2d');
  x.translate(c.width, 0); x.scale(-1, 1);
  x.drawImage(v, 0, 0);
  mainImg.src = c.toDataURL('image/png');
  mainImg.onload = () => go.disabled = false;
  document.getElementById('close').click();
};

async function getCleanPerson(img) {
  return new Promise(res => {
    ai.onResults(results => {
      const c = document.createElement('canvas');
      c.width = img.width; c.height = img.height;
      const x = c.getContext('2d');
      
      // Edge Smoothing Logic
      x.save();
      x.filter = "blur(2px)"; // ‡§∏‡§ø‡§ï‡•ã‡§°‡§º‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ï‡§ø‡§®‡§æ‡§∞‡•ã‡§Ç ‡§ï‡•ã ‡§•‡•ã‡§°‡§º‡§æ ‡§ß‡•Å‡§Ç‡§ß‡§≤‡§æ ‡§ï‡§∞‡•á‡§Ç
      x.drawImage(results.segmentationMask, 0, 0);
      x.globalCompositeOperation = 'source-in';
      x.filter = "none";
      x.drawImage(results.image, 0, 0);
      x.restore();
      res(c);
    });
    ai.send({image: img});
  });
}

go.onclick = async () => {
  loader.style.display = 'block';
  const person = await getCleanPerson(mainImg);
  
  let [pw, ph] = document.getElementById('pSize').value.split(',').map(Number);
  const bg = document.getElementById('pColor').value;
  const border = parseInt(document.getElementById('pBorder').value);
  const copies = parseInt(document.getElementById('pCopies').value);

  const single = document.createElement('canvas');
  single.width = pw; single.height = ph;
  const sCtx = single.getContext('2d');

  sCtx.fillStyle = bg;
  sCtx.fillRect(0, 0, pw, ph);

  // Deep Zoom & Offset (‡§ó‡§≤‡•á ‡§ï‡•á ‡§¶‡§æ‡§ó ‡§π‡§ü‡§æ‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è)
  const zoom = 1.25; // 25% ‡§ú‡§º‡•Ç‡§Æ
  const ar = person.width / person.height;
  let sx, sy, sw, sh;
  
  if(ar > pw/ph) {
    sh = person.height / zoom; sw = sh * (pw/ph);
    sx = (person.width - sw)/2; sy = person.height * 0.05;
  } else {
    sw = person.width / zoom; sh = sw * (ph/pw);
    sx = (person.width - sw)/2; sy = person.height * 0.05;
  }

  sCtx.drawImage(person, sx, sy, sw, sh, 0, 0, pw, ph);

  // Sheet Build
  const cols = (copies > 4) ? 4 : 2;
  const rows = Math.ceil(copies / cols);
  canvas.width = cols * (pw + 10) + 20;
  canvas.height = rows * (ph + 10) + 20;
  ctx.fillStyle = "#fff";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  for(let i=0; i<copies; i++) {
    const x = 15 + (i%cols)*(pw+10);
    const y = 15 + Math.floor(i/cols)*(ph+10);
    if(border > 0) { ctx.fillStyle="#000"; ctx.fillRect(x-border, y-border, pw+border*2, ph+border*2); }
    ctx.drawImage(single, x, y);
  }

  loader.style.display = 'none';
  document.getElementById('res').style.display = 'block';
  document.getElementById('dl').href = canvas.toDataURL('image/jpeg', 0.95);
  document.getElementById('dl').download = "clean_passport.jpg";
};
</script>
</body>
  </html>

CTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Passport Photo Maker - n-dizi.in</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>

<style>
  /* Base CSS */
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,#667eea,#764ba2);min-height:100vh;padding:10px}
  .container{max-width:900px;margin:auto;background:#fff;border-radius:16px;box-shadow:0 20px 60px rgba(0,0,0,.35);overflow:hidden}
  .header{background:linear-gradient(135deg,#1e3c72,#2a5298);color:#fff;padding:20px;text-align:center}
  .content{padding:20px}
  
  /* Upload & Camera Buttons */
  .upload-section{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:15px}
  .upload-btn, .camera-btn{border:2px dashed #667eea;border-radius:12px;padding:25px 15px;text-align:center;cursor:pointer;background:#f6f7ff;transition:.25s}
  .upload-btn:hover, .camera-btn:hover{background:#eef0ff;transform:scale(1.02)}
  .icon{font-size:30px;margin-bottom:5px}
  
  input[type=file]{display:none}

  /* Settings Area */
  .settings{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;margin-bottom:15px}
  .setting{background:#f8f9fa;border:2px solid #e5e7eb;border-radius:10px;padding:10px}
  .setting label{display:block;font-weight:600;font-size:12px;margin-bottom:5px}
  .setting select, .setting input{width:100%}

  .btn{width:100%;padding:14px;border:none;border-radius:25px;font-weight:700;font-size:15px;cursor:pointer;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;box-shadow:0 8px 25px rgba(102,126,234,.45)}
  .btn:disabled{opacity:.5;cursor:not-allowed}

  #loadingStatus{display:none;text-align:center;color:#764ba2;font-weight:bold;margin:15px 0}
  
  .result{display:none;text-align:center;margin-top:20px}
  canvas{max-width:100%;border-radius:12px;box-shadow:0 12px 40px rgba(0,0,0,.2)}

  /* Camera Modal */
  .camera-modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.9);z-index:999;display:flex;align-items:center;justify-content:center}
  .camera-box{background:#fff;width:90%;max-width:400px;padding:15px;border-radius:12px;text-align:center}
  video{width:100%;border-radius:10px;background:#000;transform: scaleX(-1);} /* Mirror view */
  .cam-controls{margin-top:15px;display:flex;gap:10px;justify-content:center}
  .capture{background:#16a085;color:#fff;padding:10px 20px;border-radius:20px;border:none;cursor:pointer;font-weight:bold}
  .close{background:#e74c3c;color:#fff;padding:10px 20px;border-radius:20px;border:none;cursor:pointer;font-weight:bold}

  @media(max-width:600px){ .upload-section, .settings{grid-template-columns:1fr} }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üéØ AI Passport Photo Maker</h1>
    <p>Professional Quality ‚Ä¢ Zero Backend ‚Ä¢ 100% Private</p>
  </div>

  <div class="content">
    <div class="upload-section">
      <div class="upload-btn" onclick="document.getElementById('fileInput').click()">
        <div class="icon">üìÅ</div>
        <h3>Upload Photo</h3>
      </div>
      <div class="camera-btn" id="cameraBtn">
        <div class="icon">üì∏</div>
        <h3>Take Photo</h3>
      </div>
    </div>

    <input type="file" id="fileInput" accept="image/*">

    <div class="settings">
      <div class="setting">
        <label>üìê Photo Size</label>
        <select id="size">
          <option value="350,450">Passport (3.5x4.5 cm)</option>
          <option value="400,400">Stamp Size (2x2 inch)</option>
        </select>
      </div>
      <div class="setting">
        <label>üé® Background Color</label>
        <input type="color" id="bgColor" value="#3b92d1">
      </div>
      <div class="setting">
        <label>üìã Copies</label>
        <select id="copies">
          <option value="4">4 Photos</option>
          <option value="8" selected>8 Photos</option>
          <option value="12">12 Photos</option>
        </select>
      </div>
      <div class="setting">
        <label>üñº Border Thickness</label>
        <input type="range" id="border" min="0" max="10" value="2">
      </div>
    </div>

    <div id="loadingStatus">‚è≥ AI is working... Processing edges</div>
    <button class="btn" id="generate" disabled>üöÄ Generate Print Sheet</button>

    <div class="result" id="resultArea">
      <canvas id="mainCanvas"></canvas>
      <p style="margin-top:10px; font-size:12px; color:#666;">Tip: Long press on image to Download</p>
    </div>
  </div>
</div>

<div class="camera-modal" id="cameraModal" style="display:none;">
  <div class="camera-box">
    <video id="video" autoplay playsinline></video>
    <div class="cam-controls">
      <button class="capture" id="captureBtn">üì∏ Capture</button>
      <button class="close" id="closeCamBtn">Close</button>
    </div>
  </div>
</div>

<script>
  const fileInput = document.getElementById('fileInput');
  const generateBtn = document.getElementById('generate');
  const loadingStatus = document.getElementById('loadingStatus');
  const mainCanvas = document.getElementById('mainCanvas');
  const ctx = mainCanvas.getContext('2d');
  
  let userImage = new Image();
  let stream = null;

  // 1. Initialize Selfie Segmentation
  const selfieSegmentation = new SelfieSegmentation({locateFile: (file) => {
    return `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`;
  }});
  selfieSegmentation.setOptions({ modelSelection: 1 });

  // 2. Image Loading
  fileInput.onchange = (e) => {
    const reader = new FileReader();
    reader.onload = () => {
      userImage.onload = () => { generateBtn.disabled = false; };
      userImage.src = reader.result;
    };
    reader.readAsDataURL(e.target.files[0]);
  };

  // 3. Camera Controls (FIXED)
  const cameraBtn = document.getElementById('cameraBtn');
  const cameraModal = document.getElementById('cameraModal');
  const video = document.getElementById('video');

  cameraBtn.onclick = async () => {
    try {
      stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
      video.srcObject = stream;
      cameraModal.style.display = 'flex';
    } catch (err) {
      alert("Camera access denied or not available.");
    }
  };

  document.getElementById('closeCamBtn').onclick = () => {
    cameraModal.style.display = 'none';
    if(stream) stream.getTracks().forEach(track => track.stop());
  };

  document.getElementById('captureBtn').onclick = () => {
    const tempCanvas = document.createElement('canvas');
    tempCanvas.width = video.videoWidth;
    tempCanvas.height = video.videoHeight;
    const tCtx = tempCanvas.getContext('2d');
    
    // Reverse mirror effect for capture
    tCtx.translate(tempCanvas.width, 0);
    tCtx.scale(-1, 1);
    tCtx.drawImage(video, 0, 0);
    
    userImage.onload = () => { generateBtn.disabled = false; };
    userImage.src = tempCanvas.toDataURL('image/png');
    
    cameraModal.style.display = 'none';
    if(stream) stream.getTracks().forEach(track => track.stop());
  };

  // 4. Background Removal Logic
  async function removeBackground(inputImg) {
    return new Promise((resolve) => {
      selfieSegmentation.onResults((results) => {
        const maskCanvas = document.createElement('canvas');
        maskCanvas.width = inputImg.width;
        maskCanvas.height = inputImg.height;
        const mCtx = maskCanvas.getContext('2d');

        mCtx.save();
        mCtx.clearRect(0, 0, maskCanvas.width, maskCanvas.height);
        mCtx.drawImage(results.segmentationMask, 0, 0, maskCanvas.width, maskCanvas.height);
        mCtx.globalCompositeOperation = 'source-in';
        mCtx.drawImage(results.image, 0, 0);
        mCtx.restore();
        resolve(maskCanvas);
      });
      selfieSegmentation.send({image: inputImg});
    });
  }

  // 5. Generate Final Sheet
  generateBtn.onclick = async () => {
    generateBtn.disabled = true;
    loadingStatus.style.display = 'block';

    const processedPerson = await removeBackground(userImage);

    const [pw, ph] = document.getElementById('size').value.split(',').map(Number);
    const bgColor = document.getElementById('bgColor').value;
    const copies = parseInt(document.getElementById('copies').value);
    const border = parseInt(document.getElementById('border').value);
    const gap = 20;

    const cols = (copies <= 4) ? 2 : (copies <= 8) ? 4 : 4;
    const rows = Math.ceil(copies / cols);

    mainCanvas.width = cols * (pw + 2 * border) + (cols + 1) * gap;
    mainCanvas.height = rows * (ph + 2 * border) + (rows + 1) * gap;

    ctx.fillStyle = "#ffffff";
    ctx.fillRect(0, 0, mainCanvas.width, mainCanvas.height);

    for (let i = 0; i < copies; i++) {
      const r = Math.floor(i / cols);
      const c = i % cols;
      const x = gap + c * (pw + 2 * border + gap);
      const y = gap + r * (ph + 2 * border + gap);

      // Background
      ctx.fillStyle = bgColor;
      ctx.fillRect(x + border, y + border, pw, ph);

      // Person Crop
      const ar = processedPerson.width / processedPerson.height;
      let sx, sy, sw, sh;
      if (ar > pw / ph) {
        sw = processedPerson.height * (pw / ph);
        sh = processedPerson.height;
        sx = (processedPerson.width - sw) / 2;
        sy = 0;
      } else {
        sw = processedPerson.width;
        sh = processedPerson.width * (ph / pw);
        sx = 0;
        sy = (processedPerson.height - sh) / 4; // Focus more on head
      }

      ctx.drawImage(processedPerson, sx, sy, sw, sh, x + border, y + border, pw, ph);

      // Border
      if(border > 0) {
        ctx.strokeStyle = "#000000";
        ctx.lineWidth = border;
        ctx.strokeRect(x + border/2, y + border/2, pw + border, ph + border);
      }
    }

    loadingStatus.style.display = 'none';
    document.getElementById('resultArea').style.display = 'block';
    generateBtn.disabled = false;
  };
</script>

</body>
</hthtml<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Passport Photo Maker - n-dizi.in</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation"></script>

<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#f0f2f5; padding:10px; color:#333}
  .container{max-width:850px; margin:auto; background:#fff; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.1); overflow:hidden}
  
  .header{background:linear-gradient(135deg,#1e3c72,#2a5298); color:#fff; padding:25px; text-align:center}
  .header h1{font-size:24px; margin-bottom:5px}
  
  .instructions{background:#fff9db; padding:15px; margin:15px; border-radius:10px; border-left:5px solid #fcc419; font-size:13px}
  .instructions b{display:block; margin-bottom:5px; color:#947600}

  .content{padding:20px}
  .upload-section{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px}
  .box-btn{border:2px dashed #4facfe; border-radius:12px; padding:20px; text-align:center; cursor:pointer; background:#f0f8ff; transition:0.3s}
  .box-btn:hover{background:#e1f0ff; transform:translateY(-2px)}
  input[type=file]{display:none}

  .settings{display:grid; grid-template-columns:repeat(auto-fit, minmax(150px, 1fr)); gap:15px; margin-bottom:20px}
  .setting-item{background:#f8f9fa; padding:12px; border-radius:8px; border:1px solid #dee2e6}
  .setting-item label{display:block; font-size:12px; font-weight:bold; margin-bottom:5px; color:#555}
  .setting-item select, .setting-item input{width:100%; padding:8px; border-radius:5px; border:1px solid #ccc}

  .main-btn{width:100%; padding:15px; border:none; border-radius:30px; font-weight:bold; font-size:16px; cursor:pointer; background:linear-gradient(to right, #4facfe 0%, #00f2fe 100%); color:#fff; box-shadow:0 5px 15px rgba(79,172,254,0.4)}
  .main-btn:disabled{background:#ccc; cursor:not-allowed; box-shadow:none}

  #loading{display:none; text-align:center; margin:15px 0; color:#1e3c72; font-weight:bold}

  .result-area{display:none; text-align:center; margin-top:25px; padding-top:20px; border-top:2px solid #eee}
  canvas{max-width:100%; border-radius:5px; margin-bottom:15px; box-shadow:0 5px 15px rgba(0,0,0,0.2)}
  
  .action-btns{display:flex; gap:10px; justify-content:center; margin-top:10px}
  .download-btn{background:#27ae60; color:#fff; padding:12px 25px; border-radius:25px; text-decoration:none; font-weight:bold}
  .print-btn{background:#2980b9; color:#fff; padding:12px 25px; border-radius:25px; border:none; font-weight:bold; cursor:pointer}

  /* Camera Modal */
  .modal{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.8); z-index:1000; align-items:center; justify-content:center}
  .modal-content{background:#fff; padding:20px; border-radius:15px; width:90%; max-width:400px; text-align:center}
  video{width:100%; border-radius:10px; background:#000; transform:scaleX(-1)}
  .cam-btns{margin-top:15px; display:flex; gap:10px; justify-content:center}

  @media(max-width:500px){ .upload-section{grid-template-columns:1fr} }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h1>üéØ AI Passport Photo Maker</h1>
    <p>Professional Prints in Seconds</p>
  </div>

  <div class="instructions">
    <b>üí° ‡§ï‡•à‡§∏‡•á ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç (Instructions):</b>
    1. 'Upload' ‡§¨‡§ü‡§® ‡§∏‡•á ‡§Ö‡§™‡§®‡•Ä ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç ‡§Ø‡§æ 'Take Photo' ‡§∏‡•á ‡§§‡•Å‡§∞‡§Ç‡§§ ‡§´‡•ã‡§ü‡•ã ‡§ñ‡•Ä‡§Ç‡§ö‡•á‡§Ç‡•§<br>
    2. ‡§Ö‡§™‡§®‡§æ ‡§™‡§∏‡§Ç‡§¶‡•Ä‡§¶‡§æ 'Size' ‡§î‡§∞ 'Background Color' ‡§ö‡•Å‡§®‡•á‡§Ç‡•§<br>
    3. 'Generate' ‡§™‡§∞ ‡§ï‡•ç‡§≤‡§ø‡§ï ‡§ï‡§∞‡•á‡§Ç‡•§ ‡§°‡§æ‡§â‡§®‡§≤‡•ã‡§° ‡§Ø‡§æ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§¨‡§ü‡§® ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡§ï‡•á ‡§Ö‡§™‡§®‡•Ä ‡§´‡§æ‡§á‡§≤ ‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç‡•§
  </div>

  <div class="content">
    <div class="upload-section">
      <div class="box-btn" onclick="document.getElementById('fileInput').click()">üìÅ Upload Photo</div>
      <div class="box-btn" id="startCam">üì∏ Take Photo</div>
    </div>
    <input type="file" id="fileInput" accept="image/*">

    <div class="settings">
      <div class="setting-item">
        <label>Photo Size</label>
        <select id="size">
          <option value="350,450">Passport (3.5x4.5 cm)</option>
          <option value="413,531">Visa (USA/India 2x2 inch)</option>
          <option value="236,354">Stamp Size</option>
          <option value="350,450,A4">Full A4 Page Sheet</option>
        </select>
      </div>
      <div class="setting-item">
        <label>BG Color</label>
        <input type="color" id="bgColor" value="#3b92d1">
      </div>
      <div class="setting-item">
        <label>Copies</label>
        <select id="copies">
          <option value="4">4 Photos</option>
          <option value="8" selected>8 Photos</option>
          <option value="12">12 Photos</option>
          <option value="24">24 Photos</option>
        </select>
      </div>
      <div class="setting-item">
        <label>Border</label>
        <input type="range" id="border" min="0" max="10" value="2">
      </div>
    </div>

    <div id="loading">‚è≥ AI Processing... please wait</div>
    <button class="main-btn" id="generate" disabled>üöÄ Generate Print Ready Sheet</button>

    <div class="result-area" id="resultArea">
      <canvas id="outputCanvas"></canvas>
      <div class="action-btns">
        <a href="#" class="download-btn" id="download">üì• Download Image</a>
        <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Sheet</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="camModal">
  <div class="modal-content">
    <video id="video" autoplay playsinline></video>
    <div class="cam-btns">
      <button class="download-btn" id="capture">Capture</button>
      <button class="print-btn" style="background:#e74c3c" id="closeCam">Close</button>
    </div>
  </div>
</div>

<script>
  const fileInput = document.getElementById('fileInput');
  const generateBtn = document.getElementById('generate');
  const canvas = document.getElementById('outputCanvas');
  const ctx = canvas.getContext('2d');
  const loading = document.getElementById('loading');
  let userImg = new Image();

  // Initialize AI
  const selfieSegmentation = new SelfieSegmentation({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`});
  selfieSegmentation.setOptions({ modelSelection: 1 });

  fileInput.onchange = (e) => {
    const reader = new FileReader();
    reader.onload = () => { userImg.src = reader.result; userImg.onload = () => generateBtn.disabled = false; };
    reader.readAsDataURL(e.target.files[0]);
  };

  // Camera Logic
  const video = document.getElementById('video');
  document.getElementById('startCam').onclick = async () => {
    const stream = await navigator.mediaDevices.getUserMedia({video: true});
    video.srcObject = stream;
    document.getElementById('camModal').style.display = 'flex';
  };

  document.getElementById('closeCam').onclick = () => {
    video.srcObject.getTracks().forEach(t => t.stop());
    document.getElementById('camModal').style.display = 'none';
  };

  document.getElementById('capture').onclick = () => {
    const c = document.createElement('canvas');
    c.width = video.videoWidth; c.height = video.videoHeight;
    const cx = c.getContext('2d');
    cx.translate(c.width, 0); cx.scale(-1, 1);
    cx.drawImage(video, 0, 0);
    userImg.src = c.toDataURL('image/png');
    userImg.onload = () => generateBtn.disabled = false;
    document.getElementById('closeCam').click();
  };

  async function removeBG(img) {
    return new Promise(res => {
      selfieSegmentation.onResults(results => {
        const c = document.createElement('canvas');
        c.width = img.width; c.height = img.height;
        const cx = c.getContext('2d');
        cx.drawImage(results.segmentationMask, 0, 0, c.width, c.height);
        cx.globalCompositeOperation = 'source-in';
        cx.drawImage(results.image, 0, 0);
        res(c);
      });
      selfieSegmentation.send({image: img});
    });
  }

  generateBtn.onclick = async () => {
    loading.style.display = 'block';
    const person = await removeBG(userImg);
    
    let [pw, ph, type] = document.getElementById('size').value.split(',');
    pw = parseInt(pw); ph = parseInt(ph);
    const bg = document.getElementById('bgColor').value;
    const border = parseInt(document.getElementById('border').value);
    const copies = parseInt(document.getElementById('copies').value);

    // Canvas Sheet Logic
    const cols = (copies > 8) ? 6 : 4;
    const rows = Math.ceil(copies / cols);
    canvas.width = cols * (pw + 10) + 20;
    canvas.height = rows * (ph + 10) + 20;

    ctx.fillStyle = "#fff";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    for(let i=0; i<copies; i++) {
      const x = 15 + (i % cols) * (pw + 10);
      const y = 15 + Math.floor(i / cols) * (ph + 10);
      
      ctx.fillStyle = bg;
      ctx.fillRect(x, y, pw, ph);

      // Smart Crop
      const ar = person.width / person.height;
      let sx, sy, sw, sh;
      if(ar > pw/ph) { sh=person.height; sw=sh*(pw/ph); sx=(person.width-sw)/2; sy=0; }
      else { sw=person.width; sh=sw*(ph/pw); sx=0; sy=(person.height-sh)/4; }

      ctx.drawImage(person, sx, sy, sw, sh, x, y, pw, ph);
      
      if(border > 0) {
        ctx.strokeStyle = "#000"; ctx.lineWidth = border;
        ctx.strokeRect(x, y, pw, ph);
      }
    }

    loading.style.display = 'none';
    document.getElementById('resultArea').style.display = 'block';
    document.getElementById('download').href = canvas.toDataURL('image/jpeg', 0.9);
    document.getElementById('download').download = "passport_photos.jpg";
  };
</script>
</body>
      </html>
